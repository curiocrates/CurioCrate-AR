<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Interactive Cube on Camera Feed</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls-component@1.3.0/dist/aframe-orbit-controls-component.min.js"></script>
</head>
<body style="margin:0; overflow:hidden; display:flex; justify-content:center; align-items:center; height:100vh; background:#222;">

<button id="startButton" style="font-size:20px; padding:20px;">Start AR Cube</button>

<script>
document.querySelector("#startButton").addEventListener("click", async () => {
  // Hide button
  document.querySelector("#startButton").style.display = "none";

  // Create A-Frame scene
  const scene = document.createElement("a-scene");
  scene.setAttribute("embedded", "");
  scene.setAttribute("vr-mode-ui", "enabled: false");
  document.body.appendChild(scene);

  // Video element for camera feed
  const video = document.createElement("video");
  video.setAttribute("id", "camVideo");
  video.setAttribute("autoplay", "");
  video.setAttribute("playsinline", "");
  video.setAttribute("webkit-playsinline", "");
  document.body.appendChild(video);

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false });
    video.srcObject = stream;
  } catch(err) {
    alert("Camera error: " + err);
    return;
  }

  // Assets
  const assets = document.createElement("a-assets");
  const videoAsset = document.createElement("video");
  videoAsset.setAttribute("id","camVideoAsset");
  videoAsset.srcObject = video.srcObject;
  assets.appendChild(videoAsset);
  scene.appendChild(assets);

  // Sky with video texture
  const sky = document.createElement("a-sky");
  sky.setAttribute("src","#camVideoAsset");
  scene.appendChild(sky);

  // Cube
  const cube = document.createElement("a-box");
  cube.setAttribute("position","0 1 -1");
  cube.setAttribute("rotation","0 45 0");
  cube.setAttribute("width","0.2");
  cube.setAttribute("height","0.2");
  cube.setAttribute("depth","0.2");
  cube.setAttribute("color","gold");
  cube.setAttribute("orbit-controls","target: 0 1 -1; enableDamping: true; dampingFactor:0.1; rotateSpeed:0.8; zoomSpeed:0.8; minDistance:0.3; maxDistance:2");
  scene.appendChild(cube);

  // Camera
  const camera = document.createElement("a-entity");
  camera.setAttribute("camera","");
  camera.setAttribute("position","0 1.6 0");
  scene.appendChild(camera);
});
</script>
</body>
</html>
